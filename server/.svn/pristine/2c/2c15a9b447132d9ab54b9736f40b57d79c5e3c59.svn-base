package com.cheyooh.service.sdk.action.notify;

import org.apache.commons.lang.StringUtils;

import com.cheyooh.service.dal.DAL;
import com.cheyooh.service.dal.DALFactory;
import com.cheyooh.service.framework.idata.Cmd;
import com.cheyooh.service.framework.idata.Result;
import com.cheyooh.service.framework.idata.ResultXJContent;
import com.cheyooh.service.sdk.db.dao.SdkNotifyMmdoMapper;
import com.cheyooh.service.sdk.db.entity.SdkNotifyMmdo;
import com.cheyooh.service.sdk.db.entity.SdkNotifyMmdoExample;

public class ZmzfResultNotify extends AbstractNotifyService<Cmd> {
	/*
	 * (non-Javadoc)
	 * 
	 * @see
	 * com.cheyooh.service.framework.basic.Service#verify(com.cheyooh.service
	 * .framework.idata.Cmd)
	 */
	@Override
	protected Result verify(Cmd cmd) {
		return null;
	}

	/*
	 * (non-Javadoc)
	 * 
	 * @see
	 * com.cheyooh.service.framework.basic.Service#execute(com.cheyooh.service
	 * .framework.idata.Cmd)
	 */
	@SuppressWarnings("unused")
	@Override
	protected Result execute(Cmd cmd) {
		DAL dal = DALFactory.createDAL();
		try {
			String pid = cmd.getServiceContext().getRequest()
					.getParameter("pid");
			String imsi = cmd.getServiceContext().getRequest()
					.getParameter("imsi");
			logger.debug("the zmzf imsi = " + imsi);
			String imei = cmd.getServiceContext().getRequest()
					.getParameter("imei");
			String price = cmd.getServiceContext().getRequest()
					.getParameter("price");
			String datestamp = cmd.getServiceContext().getRequest()
					.getParameter("datestamp");
			String tradeid = cmd.getServiceContext().getRequest()
					.getParameter("tradeid");
			if(StringUtils.isEmpty(tradeid)){
				tradeid="";
			}
			String province = cmd.getServiceContext().getRequest()
					.getParameter("province");
			logger.info("the zmzf orderNo = " + tradeid);
			String phone = cmd.getServiceContext().getRequest()
					.getParameter("phone");
			
			
//			SdkNotifyMmdo sdkNotifyMmdo = new SdkNotifyMmdo();
//			/*记录省份，
//			北京,上海,天津,重庆,黑龙,吉林,辽宁,内蒙,河北,新疆,甘肃,青海,陕西,宁夏,河南,山东,山西,
//			安徽,湖北,湖南,江苏,四川,贵州,云南,广西,西藏,浙江,江西,广东,福建,台湾,海南,香港,澳门
//			BJ,SH,TJ,CQ,HLJ,JL,LN,NM,HB,XJ,GS,QH,SAX,NX,HN,SD,SX,
//			AH,HUB,HUN,JS,SC,GZ,YN,GX,XZ,ZJ,JX,GD,FJ,TW,HND,XG,AM*/
//			String key="";
//			if(StringUtils.isNotEmpty(province)&&StringUtils.isNotBlank(province)){
//				if("BJ".equals(province)){
//					key="11";
//				}else if("SH".equals(province)){
//					key="31";
//				}else if("TJ".equals(province)){
//					key="12";
//				}else if("TJ".equals(province)){
//					key="12";
//				}else if("CQ".equals(province)){
//					key="50";
//				}else if("HLJ".equals(province)){
//					key="23";
//				}else if("JL".equals(province)){
//					key="22";
//				}else if("LN".equals(province)){
//					key="21";
//				}else if("NM".equals(province)){
//					key="15";
//				}else if("HB".equals(province)){
//					key="13";
//				}else if("XJ".equals(province)){
//					key="65";
//				}else if("GS".equals(province)){
//					key="62";
//				}else if("QH".equals(province)){
//					key="63";
//				}else if("SAX".equals(province)){
//					key="61";
//				}else if("NX".equals(province)){
//					key="64";
//				}else if("HN".equals(province)){
//					key="41";
//				}else if("SD".equals(province)){
//					key="37";
//				}else if("SX".equals(province)){
//					key="14";
//				}else if("AH".equals(province)){
//					key="34";
//				}else if("HUB".equals(province)){
//					key="42";
//				}else if("HUN".equals(province)){
//					key="43";
//				}else if("JS".equals(province)){
//					key="32";
//				}else if("SC".equals(province)){
//					key="51";
//				}else if("GZ".equals(province)){
//					key="52";
//				}else if("YN".equals(province)){
//					key="53";
//				}else if("GX".equals(province)){
//					key="45";
//				}else if("XZ".equals(province)){
//					key="54";
//				}else if("ZJ".equals(province)){
//					key="33";
//				}else if("JX".equals(province)){
//					key="36";
//				}else if("GD".equals(province)){
//					key="44";
//				}else if("FJ".equals(province)){
//					key="35";
//				}else if("TW".equals(province)){
//					key="71";
//				}else if("HND".equals(province)){
//					key="46";
//				}else if("XG".equals(province)){
//					key="81";
//				}else if("AM".equals(province)){
//					key="82";
//				}
//				sdkNotifyMmdo.setKey(key);
//			}
//			if(StringUtils.isNotEmpty(phone)&&StringUtils.isNotBlank(phone)){
//				sdkNotifyMmdo.setMobile(phone);
//			}
			
//			SdkOrderMapper sdkOrderMapper = dal.getMapper(SdkOrderMapper.class);
//			SdkOrderExample sdkOrderExample = new SdkOrderExample();
//			sdkOrderExample.createCriteria().andOrderNoEqualTo(tradeid);
//			SdkOrder sdkOrder = sdkOrderMapper.selectOne(sdkOrderExample);
//			if (sdkOrder != null) {
//				SdkOrderMmdoMapper sdkOrderMmdoMapper = dal
//						.getMapper(SdkOrderMmdoMapper.class);
//				SdkOrderMmdoExample sdkOrderMmdoExample = new SdkOrderMmdoExample();
//				sdkOrderMmdoExample.createCriteria().andPayIdEqualTo(
//						sdkOrder.getPayId());
//				SdkOrderMmdo sdkOrderMmdo = sdkOrderMmdoMapper
//						.selectOne(sdkOrderMmdoExample);
//				if (sdkOrderMmdo != null) {
//					sdkNotifyMmdo.setOrderNo(tradeid);
//					sdkNotifyMmdo.setLinkid(tradeid);
//					sdkNotifyMmdo.setSpid(sdkOrderMmdo.getRespSendNumber());
//					sdkNotifyMmdo.setCmd(sdkOrderMmdo.getRespSendContent());
//					SdkTelephoneMapper sdkTelephoneMapper=dal.getMapper(SdkTelephoneMapper.class);
//					SdkTelephoneExample sdkTelephoneExample=new SdkTelephoneExample();
//					sdkTelephoneExample.createCriteria().andImsiEqualTo(imsi);
//					SdkTelephone sdkTelephone=sdkTelephoneMapper.selectOne(sdkTelephoneExample);
//					if(sdkTelephone!=null){
//						sdkNotifyMmdo.setMobile(sdkTelephone.getMobilephone());
//						sdkNotifyMmdo.setKey(String.valueOf(sdkTelephone.getProvinceNo()));
//					}
//					sdkNotifyMmdo.setSpnum(sdkOrderMmdo.getReqSendNumber());
//					sdkNotifyMmdo.setGameId(sdkOrderMmdo.getGameId());
//					sdkNotifyMmdo.setAmount(sdkOrderMmdo.getReqOrderAmount());
//					sdkNotifyMmdo.setCreateTime(new Date());
//					sdkNotifyMmdo.setOperationType(sdkOrderMmdo.getOperationType());
//					sdkNotifyMmdo.setPayChannelCode(sdkOrderMmdo
//							.getPayChannelCode());
//					sdkNotifyMmdo.setAdditionalStatus(sdkOrderMmdo.getAdditionalStatus());
//					SdkNotifyMmdoMapper sdkNotifyMmdoMapper = dal
//							.getMapper(SdkNotifyMmdoMapper.class);
//					sdkNotifyMmdoMapper.insertSelective(sdkNotifyMmdo);
//				}
//			}
			SdkNotifyMmdoMapper sdkNotifyMmdoMapper = dal.getMapper(SdkNotifyMmdoMapper.class);
			SdkNotifyMmdoExample sdkNotifyMmdoExample=new SdkNotifyMmdoExample();
			sdkNotifyMmdoExample.createCriteria().andOrderNoEqualTo(tradeid);
			SdkNotifyMmdo sdkNotifyMmdo=sdkNotifyMmdoMapper.selectOne(sdkNotifyMmdoExample);
			if(sdkNotifyMmdo!=null){
				/*记录省份，
				北京,上海,天津,重庆,黑龙,吉林,辽宁,内蒙,河北,新疆,甘肃,青海,陕西,宁夏,河南,山东,山西,
				安徽,湖北,湖南,江苏,四川,贵州,云南,广西,西藏,浙江,江西,广东,福建,台湾,海南,香港,澳门
				BJ,SH,TJ,CQ,HLJ,JL,LN,NM,HB,XJ,GS,QH,SAX,NX,HN,SD,SX,
				AH,HUB,HUN,JS,SC,GZ,YN,GX,XZ,ZJ,JX,GD,FJ,TW,HND,XG,AM*/
				String key="";
				if(StringUtils.isNotEmpty(province)&&StringUtils.isNotBlank(province)){
					if("BJ".equals(province)){
						key="11";
					}else if("SH".equals(province)){
						key="31";
					}else if("TJ".equals(province)){
						key="12";
					}else if("TJ".equals(province)){
						key="12";
					}else if("CQ".equals(province)){
						key="50";
					}else if("HLJ".equals(province)){
						key="23";
					}else if("JL".equals(province)){
						key="22";
					}else if("LN".equals(province)){
						key="21";
					}else if("NM".equals(province)){
						key="15";
					}else if("HB".equals(province)){
						key="13";
					}else if("XJ".equals(province)){
						key="65";
					}else if("GS".equals(province)){
						key="62";
					}else if("QH".equals(province)){
						key="63";
					}else if("SAX".equals(province)){
						key="61";
					}else if("NX".equals(province)){
						key="64";
					}else if("HN".equals(province)){
						key="41";
					}else if("SD".equals(province)){
						key="37";
					}else if("SX".equals(province)){
						key="14";
					}else if("AH".equals(province)){
						key="34";
					}else if("HUB".equals(province)){
						key="42";
					}else if("HUN".equals(province)){
						key="43";
					}else if("JS".equals(province)){
						key="32";
					}else if("SC".equals(province)){
						key="51";
					}else if("GZ".equals(province)){
						key="52";
					}else if("YN".equals(province)){
						key="53";
					}else if("GX".equals(province)){
						key="45";
					}else if("XZ".equals(province)){
						key="54";
					}else if("ZJ".equals(province)){
						key="33";
					}else if("JX".equals(province)){
						key="36";
					}else if("GD".equals(province)){
						key="44";
					}else if("FJ".equals(province)){
						key="35";
					}else if("TW".equals(province)){
						key="71";
					}else if("HND".equals(province)){
						key="46";
					}else if("XG".equals(province)){
						key="81";
					}else if("AM".equals(province)){
						key="82";
					}
					sdkNotifyMmdo.setKey(key);
				}
				if(StringUtils.isNotEmpty(phone)&&StringUtils.isNotBlank(phone)){
					sdkNotifyMmdo.setMobile(phone);
				}
				int notifyStatus=1;
				sdkNotifyMmdo.setNotifyStatus(notifyStatus);
				sdkNotifyMmdoMapper.updateByPrimaryKey(sdkNotifyMmdo);
			}
			dal.commit();
		} catch (Exception e) {
			logger.error("the zmzf pay notify error!", e);
			fail("Exception: " + e.getMessage() + ", class: ".getClass());
		} finally {
			dal.close();
		}
		return success();
	}

	private Result success() {
		return new Result(new ResultXJContent("success", "success"));
	}

	private Result fail(String msg) {
		return new Result(new ResultXJContent(msg, msg));
	}
}
