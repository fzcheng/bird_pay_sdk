<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cheyooh.service.dal.db.bbs.dao.BbsDDQMapper">
	<!-- 避免Mybatis载入时出现空语句异常   --> 
	
	
	<!-- 论坛搜索 -->
	<select id="selectTest" resultType="org.apache.commons.collections.map.CaseInsensitiveMap" parameterType="org.apache.commons.collections.map.CaseInsensitiveMap">       
	   <![CDATA[	   
	      
        select t.tid ,(v.addviews + t.views ) as cnt
       
        from  bbs_forum_thread t ,    
        
        bbs_forum_threadaddviews v where t.tid = v.tid 
        
	    ]]>
	</select>
	
		
	<!-- 回复我的帖子 -->
	<select id="selectRepliesToMe" resultType="org.apache.commons.collections.map.CaseInsensitiveMap" parameterType="org.apache.commons.collections.map.CaseInsensitiveMap">       
	   <![CDATA[	   	
		SELECT
			*
		FROM
			(
				SELECT
					p.*, o.message AS originmessage
				FROM
					bbs_forum_post p
				LEFT JOIN bbs_forum_post o ON p.origin_post_id = o.pid
				WHERE
					o.authorid = #{uid,jdbcType=INTEGER}
				AND p.authorid != #{uid,jdbcType=INTEGER}
			UNION
				SELECT
					p.*, t.subject
				FROM
					bbs_forum_post p
				LEFT JOIN bbs_forum_thread t ON p.tid = t.tid
				WHERE
					t.authorid = #{uid,jdbcType=INTEGER}
				AND p.authorid != #{uid,jdbcType=INTEGER}
			) AS c
		ORDER BY pid DESC
				
	    ]]>
	</select>
	
	
	<!-- 查询昵称是否已经存在 -->
	<select id="checkNickName" resultType="org.apache.commons.collections.map.CaseInsensitiveMap" parameterType="org.apache.commons.collections.map.CaseInsensitiveMap">       
	   <![CDATA[	   	     
        select count(*) as cnt from bbs_common_member_profile where field1=#{nick_name}          
	    ]]>
	</select>
	
	<!-- 江湖榜单 -->
	
 
  
  <select id="getJiangHuBangList"  resultType="org.apache.commons.collections.map.CaseInsensitiveMap" parameterType="org.apache.commons.collections.map.CaseInsensitiveMap">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
   select C.uid as uidto,   C.extcredits2 as yingliang ,C.extcredits4 as jifeng,CASE WHEN P.field1='' then P.field2 ELSE p.field1 END  as nicheng 
from `bbs_common_member_count` C  
join bbs_common_member_profile P on C.uid=P.uid 
ORDER BY C.extcredits4  DESC 
  </select>
  
  
  <select id="getJiangHuBangYinliangList"  resultType="org.apache.commons.collections.map.CaseInsensitiveMap" parameterType="org.apache.commons.collections.map.CaseInsensitiveMap">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select C.uid as uidto,  C.extcredits2 as yingliang ,C.extcredits4 as jifeng,CASE WHEN P.field1='' then P.field2 ELSE p.field1 END  as nicheng 
from `bbs_common_member_count` C  
join bbs_common_member_profile P on C.uid=P.uid 
ORDER BY C.extcredits2  DESC 
    
  </select>
  

</mapper>